# Hadoop S3A NC Tests

1. [Introduction](#introduction)
2. [Hadoop S3A GitHub action](#hadoop-s3a-github-action)
3. [Hadoop S3A Makefile Target](#hadoop-s3a-makefile-target)
4. [Manual Run](#manual-run)


## Introduction

Hadoop S3A tests validate NooBaa's S3 compatibility against the Hadoop S3A connector used by Apache Hadoop for S3 access. These tests exercise the `hadoop-aws` module's integration and contract suites against a live NooBaa endpoint, focusing on request correctness, path-style access, and credential handling.

The CI flow runs the tests against the NC (ConfigFS) endpoint and uses a pinned Hadoop branch (`rel/release-3.3.6`) so test behavior remains consistent over time.

Upstream test sources live in the Hadoop repository:
- https://github.com/apache/hadoop/tree/rel/release-3.3.6/hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a

## Hadoop S3A GitHub action

The Hadoop S3A tests are available as a GitHub workflow that can be run manually:

- [Hadoop S3A NC Tests](../../.github/workflows/hadoop-s3a-nc-tests.yaml)

## Hadoop S3A Makefile Target

You can run the tests locally using the Makefile:

- `make hadoop-s3a-nc-tests`

This target:
- Builds the `noobaa` image.
- Starts a NC endpoint container and creates a test account/bucket.
- Runs Hadoop S3A tests inside a Maven container.
- Cleans up the endpoint container and network.

The test script is located at:
- `src/test/external_tests/hadoop_s3a_tests/run_hadoop_s3a_tests.sh`

## Manual Run

If you need to run the Maven test container manually, ensure the NooBaa NC endpoint is running and both containers share the same Docker network (`noobaa-net` by default).

Example:

```bash
docker run --rm --network noobaa-net \
  -e AWS_ACCESS_KEY_ID=<access_key> \
  -e AWS_SECRET_ACCESS_KEY=<secret_key> \
  -e S3A_ENDPOINT=<noobaa-nc-container>:6001 \
  -e HADOOP_S3A_BRANCH=rel/release-3.3.6 \
  -e HADOOP_S3A_BUCKET=s3a-test \
  -v $(pwd)/src/test/external_tests/hadoop_s3a_tests/run_hadoop_s3a_tests.sh:/usr/local/bin/run_hadoop_s3a_tests.sh:ro \
  maven:3.9.6-eclipse-temurin-11 \
  bash /usr/local/bin/run_hadoop_s3a_tests.sh
```

Replace the credentials and endpoint values with those generated by your NC deployment.
