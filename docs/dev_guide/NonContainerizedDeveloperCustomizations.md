# Non Containerized NSFS - Developer customization (OPTIONAL)

One can customize noobaa nsfs service by creation of config.json file under the config_dir/ directory.
In this file you will find the available customizable properties and a [config.json example file](#configjson-example).

The following list consists of supported optional developer customization  -

## 1. Number of forks - 
 
**Description -** Adjust the number of forks in order to increase the S3 endpoints number. This will enable NooBaa to handle a higher scale of S3 requests concurrently.

**Configuration Key -** ENDPOINT_FORKS

**Type -** number  

**Default -** 0

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the ENDPOINT_FORKS key to the desired level.
Example:
"ENDPOINT_FORKS":8
3. systemctl restart noobaa_nsfs
```

## 2. Log debug level -

**Description -** Set the debug level to control the amount of debugging information generated by the application.

Supported log debug levels:
1. default - for default debugging
2. warn - for only warning/errors debugging. 
3. nsfs - for more nsfs detailed debugging.
4. all - for all detailed debugging.


**Configuration Key -** NOOBAA_LOG_LEVEL

**Type -** string

**Default -** "default"

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the NOOBAA_LOG_LEVEL key to the desired level.
Example:
"NOOBAA_LOG_LEVEL": "nsfs"
3. systemctl restart noobaa_nsfs
```

## 3. Ports -

**Description -** Adjust the ports used by the application for communication

The following S3 endpoint ports can be customized:
1. ENDPOINT_PORT - S3 HTTP port 
2. ENDPOINT_SSL_PORT - S3 HTTPS port 
3. ENDPOINT_SSL_STS_PORT - STS HTTPS port 
4. EP_METRICS_SERVER_PORT - prometheus metrics port 


**Configuration Keys -** ENDPOINT_PORT, ENDPOINT_SSL_PORT, ENDPOINT_SSL_STS_PORT, EP_METRICS_SERVER_PORT

**Type -** number

**Default -** ENDPOINT_PORT=6001, ENDPOINT_SSL_PORT=6443, ENDPOINT_SSL_STS_PORT=7443, EP_METRICS_SERVER_PORT=-1

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"ENDPOINT_PORT": 5555
3. systemctl restart noobaa_nsfs
```

## 4. Allow http requests-
**Description -** Enable or disable listenting HTTP requests.

**Configuration Key -** ALLOW_HTTP

**Type -** boolean

**Default -** false

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"ALLOW_HTTP": true
3. systemctl restart noobaa_nsfs
```

## 5. MD5 calculation -
**Description -** Enable or disable MD5 calculation on PUT object or Multipart upload requests.

**Configuration Key -** NSFS_CALCULATE_MD5

**Type -** boolean

**Default -** false

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"NSFS_CALCULATE_MD5": true
```

## 6. UV_THREADPOOL_SIZE -
**Description -** Set UV_THREADPOOL_SIZE in order to increase the performance of NooBaa - https://docs.libuv.org/en/v1.x/threadpool.html.

**Configuration Key -** UV_THREADPOOL_SIZE

**Type -** number

**Default -** 4

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"UV_THREADPOOL_SIZE": 8
3. systemctl restart noobaa_nsfs
```

## 7. GPFS library path -
**Description -** Set GPFS library path location.

**Configuration Key -** GPFS_DL_PATH

**Type -** string

**Default -** ''

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"GPFS_DL_PATH": "/usr/lib64/libgpfs.so"
3. systemctl restart noobaa_nsfs
```

## 8. Buffer pool memory limit -
**Description -** Set Buffer pool memory limit in order to increase performance. suggested values 1-4GB, service restart required.
**Configuration Key -** NSFS_BUF_POOL_MEM_LIMIT

**Type -** number

**Default -** 32MB = 33554432 bytes = 32 * 1024 * 1024

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key in bytes-
Example: 
"NSFS_BUF_POOL_MEM_LIMIT" : 52428800
3. systemctl restart noobaa_nsfs
```

## 9. Buffer size -
**Description -** Set Buffer size in order to increase performance of small/large objects requests, service restart required.

**Configuration Key -** NSFS_BUF_SIZE

**Type -** number

**Default -** 8MB = 8388608 bytes = 8 * 1024 * 1024

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key in bytes-
Example:
"NSFS_BUF_SIZE": 10485760
3. systemctl restart noobaa_nsfs
```

## 10. Open read mode -
**Description -** Set the mode of open for read, use 'rd' for direct-io reads.

**Configuration Key -** NSFS_OPEN_READ_MODE

**Type -** string

**Default -** 'r'

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"NSFS_OPEN_READ_MODE": "rd"
```

## 11. Trigger Check bucket boundaries -
**Description -** Enable/Disable bucket boundaries checks.

**Configuration Key -** NSFS_CHECK_BUCKET_BOUNDARIES

**Type -** boolean

**Default -** true

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"NSFS_CHECK_BUCKET_BOUNDARIES": false
```

## 12. Trigger Fsync -
**Description -** Enable/Disable fsync triggers, changing value to false is unsafe for production envs.

**Configuration Key -** NSFS_TRIGGER_FSYNC

**Type -** boolean

**Default -** true

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"NSFS_TRIGGER_FSYNC": false
```

## 13. Whitelist IPs -
**Description -** List of whitelist IPs. Access is restricted to these IPs only. If there are no IPs mentioned all IPs are allowed.

**Configuration Key -** NSFS_WHITELIST

**Type -** array

**Default -** false

**Steps -**
```
1. run CLI command
node src/cmd/manage_nsfs whitelist --ips '["127.0.0.1", "192.000.10.000", "3002:0bd6:0000:0000:0000:ee00:0033:000"]'  2>/dev/null
```

## 13. Config directory backend -
**Description -** Set custom config directory backend. Set to GPFS in order to increase performance of creation/deletion of config files under the config directory.

**Configuration Key -** NSFS_NC_CONFIG_DIR_BACKEND

**Type -** string

**Default -** ''

**Steps -**
```
1. Open /path/to/config_dir/config.json file.
2. Set the config key -
Example:
"NSFS_NC_CONFIG_DIR_BACKEND": "GPFS"
```





## Config.json example 
```
> cat /path/to/config_dir/config.json
{
    "ENDPOINT_PORT": 80,
    "ENDPOINT_SSL_PORT": 443,
    "ENDPOINT_FORKS": 16,
    "UV_THREADPOOL_SIZE": 256,
    "GPFS_DL_PATH": "/usr/lpp/mmfs/lib/libgpfs.so",
    "NSFS_BUF_POOL_MEM_LIMIT": 4294967296,
    "NSFS_BUF_SIZE": 16777216,
    "NSFS_OPEN_READ_MODE": "rd",
    "NSFS_CHECK_BUCKET_BOUNDARIES": false,
    "ALLOW_HTTP": true,
    "NSFS_WHITELIST":["127.0.0.1","192.000.10.000","3002:0bd6:0000:0000:0000:ee00:0033:000"]
}

```
