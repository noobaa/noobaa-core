<!-- Copyright (C) 2016 NooBaa -->

<div class="dropdown-wrapper no-outline" data-bind="
    event: {
        blur: () => active(false),
        click: () => onClick(),
        keydown: (_, evt) => onKeyPress(evt)
    },
    attr: { tabindex: !ko.unwrap(disabled) && '0' },
    hasFocus: hasFocus,
    css: {
        disabled: disabled,
        active: active,
        invalid: invalid(),
        placeholder: selected() == null
    },
    validationOptions: { insertMessages: false },
    let: { $wrapper: $element }
">
    <div class="value no-wrap" data-bind="
        value: selected,
        text: selectedLabel
    "></div>

    <svg-icon class="icon-small chevron" params="name: 'chevron'" data-bind="
        event: { mousedown: () => $wrapper.focus() }
    "></svg-icon>

    <div class="options" data-bind="
        visible: active,
        event: {
            click: () => active(false) && true,
            mousedown: () => $wrapper.focus()
        },
        clickBubble: false
    ">
        <loading-indicator class="alt-colors align-middle pad" data-bind="visible: loading"></loading-indicator>
        <ul class="list-no-style"  data-bind="foreach: options, scrollTo: selectedIndex, visible: isOptionsVisible">
            <li data-bind="css: { seperator: !$data }, if: $data">
                <label class="option row content-middle" data-bind="
                    css: { disabled: disabled },
                    tooltip: tooltip,
                    click: () => true,
                    clickBubble: !ko.unwrap(disabled)
                ">
                    <input type="radio" data-bind="
                        attr: { name: $component.name },
                        disable: disabled,
                        checked: $component.selected,
                        checkedValue: value
                    "/>
                    <!-- ko if: icon -->
                    <svg-icon ko.css="$component.optionIconCss($data)"
                        params="name: $component.optionIconName($data)"
                    ></svg-icon>
                    <!-- /ko -->
                    <div class="option-label no-wrap greedy" >
                        <div data-bind="css: css, text: label"></div>
                        <div class="remark" data-bind="text: remark"></div>
                    </div>
                </label>
            </li>
        </ul>
        <div class="empty-dropdown"
            ko.css="emptyMessage().css"
            ko.visible="emptyMessage().visible"
        >
            {{emptyMessage().text}}
        </div>
    </div>
</div>
